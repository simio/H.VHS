<?xml version="1.0" encoding="UTF-8"?>
<grammar ns="http://play.huggpunkt.org/vhsxml/1" xmlns="http://relaxng.org/ns/structure/1.0" datatypeLibrary="http://www.w3.org/2001/XMLSchema-datatypes">
  <start>
    <element name="vhsxml">
      <attribute name="version">
        <value>2.0</value>
      </attribute>
      <interleave>
        <optional>
          <choice>
            <ref name="transportDefinitions"/>
            <ref name="transportDefinition"/>
          </choice>
        </optional>
        <optional>
          <choice>
            <ref name="formatDefinitions"/>
            <ref name="formatDefinition"/>
          </choice>
        </optional>
        <optional>
          <choice>
            <ref name="extensions"/>
            <ref name="extension"/>
          </choice>
        </optional>
        <optional>
          <choice>
            <ref name="cassettes"/>
            <ref name="cassette"/>
          </choice>
        </optional>
      </interleave>
    </element>
  </start>
  <!--
    
     TRANSPOR DEFINITIONS
    
  -->
  <define name="transportDefinitions">
    <element name="transportDefinitions">
      <zeroOrMore>
        <ref name="transportDefinition"/>
      </zeroOrMore>
    </element>
  </define>
  <define name="transportDefinition">
    <element name="transportDefinition">
      <ref name="timestampedId"/>
      <ref name="i18nName"/>
      <ref name="i18nDesc"/>
    </element>
  </define>
  <!--
    
     STREAM/FILE FORMAT DEFINITIONS
    
  -->
  <define name="formatDefinitions">
    <element name="formatDefinitions">
      <oneOrMore>
        <ref name="formatDefinition"/>
      </oneOrMore>
    </element>
  </define>
  <define name="formatDefinition">
    <element name="formatDefinition">
      <ref name="timestampedId"/>
      <ref name="i18nName"/>
      <ref name="i18nDesc"/>
      <element name="completeness">
        <choice>
          <value>any</value>
          <value>empty</value>
          <value>notEmpty</value>
          <value>metaOnly</value>
          <value>dataOnly</value>
          <value>complete</value>
        </choice>
      </element>
      <ref name="mimeType"/>
    </element>
  </define>
  <!--
    
     H.VHS EXTENSIONS
    
  -->
  <define name="extensions">
    <element name="extensions">
      <oneOrMore>
        <ref name="extension"/>
      </oneOrMore>
    </element>
  </define>
  <define name="extension">
    <element name="extension">
      <ref name="versionedId"/>
      <oneOrMore>
        <ref name="i18nName"/>
      </oneOrMore>
      <zeroOrMore>
        <ref name="i18nDesc"/>
      </zeroOrMore>
      <optional>
        <ref name="author"/>
      </optional>
      <element name="enabled">
        <choice>
          <value>true</value>
          <value>false</value>
        </choice>
      </element>
      <choice>
        <ref name="externalImplementation"/>
        <ref name="internalImplementation"/>
      </choice>
      <element name="input">
        <oneOrMore>
          <element name="transport">
            <data type="NMTOKEN"/>
          </element>
        </oneOrMore>
        <oneOrMore>
          <element name="format">
            <data type="NMTOKEN"/>
          </element>
        </oneOrMore>
      </element>
      <element name="output">
        <oneOrMore>
          <element name="transport">
            <data type="NMTOKEN"/>
          </element>
        </oneOrMore>
        <oneOrMore>
          <element name="format">
            <data type="NMTOKEN"/>
          </element>
        </oneOrMore>
      </element>
      <optional>
        <ref name="transportDefinitions"/>
      </optional>
      <optional>
        <ref name="formatDefinitions"/>
      </optional>
    </element>
  </define>
  <define name="externalImplementation">
    <element name="implementation">
      <attribute name="type">
        <choice>
          <value>qtdll</value>
          <value>vhscheme</value>
          <value>vhscript</value>
        </choice>
      </attribute>
      <attribute name="src">
        <data type="anyURI"/>
      </attribute>
      <empty/>
    </element>
  </define>
  <define name="internalImplementation">
    <element name="implementation">
      <attribute name="type">
        <choice>
          <value>vhscheme</value>
          <value>vhscript</value>
        </choice>
      </attribute>
      <data type="string"/>
    </element>
  </define>
  <!--
    
     CASSETTES (stub)
    
    Glï¿½m inte "<![CDATA[xxx]]>"
  -->
  <define name="cassettes">
    <element name="cassettes">
      <oneOrMore>
        <ref name="cassette"/>
      </oneOrMore>
    </element>
  </define>
  <define name="cassette">
    <element name="cassette">
      <ref name="timestampedId"/>
      <choice>
        <ref name="internalTypedContent"/>
        <ref name="externalTypedContent"/>
      </choice>
    </element>
  </define>
  <define name="internalTypedContent">
    <element name="content">
      <attribute name="mimeType">
        <data type="token"/>
      </attribute>
      <data type="base64Binary"/>
    </element>
  </define>
  <define name="externalTypedContent">
    <element name="content">
      <attribute name="mimeType">
        <data type="token"/>
      </attribute>
      <attribute name="src">
        <data type="anyURI"/>
      </attribute>
      <empty/>
    </element>
  </define>
  <!--
    
     DATA TYPES
    
  -->
  <define name="timestampedId">
    <element name="id">
      <attribute name="asOf">
        <data type="dateTime"/>
      </attribute>
      <data type="NMTOKEN"/>
    </element>
  </define>
  <define name="versionedId">
    <element name="id">
      <attribute name="version">
        <data type="integer"/>
      </attribute>
      <data type="NMTOKEN"/>
    </element>
  </define>
  <define name="i18nName">
    <interleave>
      <element name="name">
        <attribute name="xml:lang">
          <value>en</value>
        </attribute>
        <data type="token"/>
      </element>
      <zeroOrMore>
        <element name="name">
          <attribute name="xml:lang">
            <data type="language"/>
          </attribute>
          <data type="token"/>
        </element>
      </zeroOrMore>
    </interleave>
  </define>
  <define name="i18nDesc">
    <interleave>
      <optional>
        <element name="description">
          <attribute name="xml:lang">
            <value>en</value>
          </attribute>
          <data type="token"/>
        </element>
      </optional>
      <zeroOrMore>
        <element name="description">
          <attribute name="xml:lang">
            <data type="language"/>
          </attribute>
          <data type="token"/>
        </element>
      </zeroOrMore>
    </interleave>
  </define>
  <define name="author">
    <element name="author">
      <attribute name="email">
        <data type="token"/>
      </attribute>
      <attribute name="website">
        <data type="anyURI"/>
      </attribute>
      <data type="token"/>
    </element>
  </define>
  <define name="mimeType">
    <element name="mimeType">
      <data type="token"/>
    </element>
    <optional>
      <element name="alternateMimeTypes">
        <oneOrMore>
          <element name="mimeType">
            <data type="token"/>
          </element>
        </oneOrMore>
      </element>
    </optional>
  </define>
</grammar>
